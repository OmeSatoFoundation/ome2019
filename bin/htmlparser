#!/usr/bin/env python2
#encoding:utf-8
import sys
import ast
from bs4 import BeautifulSoup

class HTMLParser:
    def __init__(self, filename):
        self.filename = filename
        self.html = open(self.filename)
        self.soup = BeautifulSoup(self.html, 'html.parser')
        self.data = []
    def htmlsrc(self, tag):
        result = self.soup.find_all(tag)
        for i in result:
            self.data.append(i.get('src'))
    def htmltagattr(self, tag, attr):
        result = self.soup.find_all(tag, attrs=attr)
        for i in result:
            data.append(i)
    def htmltext(self, tag):
        result = self.soup.find_all(tag)
        for i in result:
            for j in i:
                data.append(j)
    def htmllink(self, tag):
        result = self.soup.find_all(tag)
        for i in result:
            data.append(i.get('href'))
    def parseattr(self, attr):
        if(len(attr) == 0):
            a = {}
        else:
            a = '{"' + attr.split(':')[0] + '":"' + ' '.join(attr.split(':')[1].split(',')) + '"}'
            a = ast.literal_eval(a) 
        return a
    def emitdata(self):
        for i in self.data:
            print(i)


def main():
    hp = HTMLParser(sys.argv[2])
    if(sys.argv[1] == 'htmlsrc'):
        hp.htmlsrc(sys.argv[3])
    elif(sys.argv[1] == 'htmltagattr'):
        hp.htmltagattr(sys.argv[3], hp.parseattr(sys.argv[4]))
    elif(sys.argv[1] == 'htmltext'):
        hp.htmltext(sys.argv[3])
    elif(sys.argv[1] == 'htmllink'):
        hp.htmllink(sys.argv[3])
    hp.emitdata()


if __name__ == '__main__':
    main()
